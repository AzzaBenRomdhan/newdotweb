<div class="main-content">
  <div class="container-fluid">
    <div *ngIf="isLoading" class="overlay-spinner">
        <mat-spinner diameter="70" strokeWidth="6" color="primary"></mat-spinner>
    </div>
    <div class="row">
      <div class="col-md-12 ml-auto mr-auto">

        <div class="card">
          <div class="card-header card-header-info">
            <h4 class="card-title">D√©tails du document</h4>
          </div>

          <div class="card-body" *ngIf="document && !isLoading">
            <button mat-raised-button style="color: black;" class="mb-3" (click)="goBack()">
              <mat-icon>arrow_back</mat-icon>
              Retour
            </button>

            <div class="passport-info mb-4" 
                *ngIf="document.typeDoc === 'P' || document.typeDoc === 'PS' || document.typeDoc === 'PD'">
              <table class="table table-bordered info-table">
                <tr>
                  <td><strong>Ajout√© le :</strong> {{ document.dateAjout }} {{ document.heureAjout }}</td>
                  <td><strong>Ajout√© par :</strong> {{ document.username }}</td>
                  <td><strong>Code pays :</strong> {{ document.issuingCountry }}</td>
                  <td>
                    <strong>Type :</strong>
                    <span [ngSwitch]="document.typeDoc">
                      <span *ngSwitchCase="'P'">Passeport ordinaire</span>
                      <span *ngSwitchCase="'PS'">Passeport de service</span>
                      <span *ngSwitchCase="'PD'">Passeport diplomatique</span>
                      <span *ngSwitchDefault>Inconnu</span>
                    </span>
                  </td>
                </tr>
              </table>
            </div>

            <div class="passport-info mb-4" 
                *ngIf="document.frontImage && document.backImage">
              <table class="table table-bordered info-table">
                <tr>
                  <td><strong>Ajout√© le :</strong> {{ document.dateAjout }} {{ document.heureAjout }}</td>
                  <td><strong>Ajout√© par :</strong> {{ document.username }}</td>
                </tr>
              </table>
            </div>
            <!-- ================= PASSEPORT ================= -->
            <mat-accordion class="accordion-spacing"
              *ngIf="document?.typeDoc === 'P' || document?.typeDoc === 'PS' || document?.typeDoc === 'PD'">

              <mat-expansion-panel hideToggle expanded
                (opened)="isPassportOpen = true"
                (closed)="isPassportOpen = false">

                <mat-expansion-panel-header
                  [class.header-open]="isPassportOpen"
                  [class.header-closed]="!isPassportOpen">

                  <mat-panel-title class="panel-title-custom">
                    Images du passeport
                  </mat-panel-title>

                </mat-expansion-panel-header>

                <div class="passport-images-container">

                  <!-- üìå Photo document (BDD - base64) -->
                  <div class="passport-image-wrapper" *ngIf="document?.visiblePasseport">
                    <h4>Photo du document</h4>
                    <div class="passport-img-box passport-img">
                      <app-magnifier
                        [src]="'data:image/jpeg;base64,' + document.visiblePasseport"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                  <!-- üìå Sp√©cimen principal (URL) -->
                  <div class="passport-image-wrapper" *ngIf="passportImages?.passportImage">
                    <h4>
                      Sp√©cimen (
                      <b>
                        Mod√®le:
                        {{ passportImages?.passport_model ? passportImages.passport_model : 'Non disponible' }}
                      </b>
                      )
                    </h4>
                    <div class="passport-img-box passport-img">
                      <app-magnifier
                        [src]="passportImages.passportImage"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                  <!-- üìå Image UV -->
                  <div class="passport-image-wrapper" *ngIf="passportImages?.uvImage">
                    <h4>Image UV ( <b>Mod√®le: {{passportImages?.passport_model ? passportImages.passport_model : 'Non disponible'}}</b> )</h4>
                    <div class="passport-img-box passport-img">
                      <app-magnifier
                        [src]="passportImages.uvImage"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                </div>
              </mat-expansion-panel>
            </mat-accordion>


            <!-- ‚≠ê ID Card Images -->
            <mat-accordion class="accordion-spacing" *ngIf="document.frontImage && document.backImage">
             <mat-expansion-panel hideToggle expanded (opened)="isIdCardOpen = true" (closed)="isIdCardOpen = false">
                <mat-expansion-panel-header [class.header-open]="isIdCardOpen" [class.header-closed]="!isIdCardOpen">
                  <mat-panel-title class="panel-title-custom">
                    ID Card Images
                  </mat-panel-title>
                </mat-expansion-panel-header>       
                
                 <div class="passport-images-container">
                <!-- Document -->
                <div class="passport-image-wrapper" *ngIf="document.frontImage">
                  <h4>Face avant</h4>
                  <div class="passport-img-box passport-img">
                   <app-magnifier
                            [src]="'data:image/jpeg;base64,' + document.frontImage"
                            [zoom]="2.5"
                            [lensSize]="180">
                    </app-magnifier>
                  </div>
                </div>

                <!-- Sp√©cimen -->
                <div class="passport-image-wrapper" *ngIf="document.backImage">
                  <h4>Face arri√®re</h4>
                  <div class="passport-img-box passport-img">
                    <app-magnifier
                            [src]="'data:image/jpeg;base64,' + document.backImage"
                            [zoom]="2.5"
                            [lensSize]="180">
                      </app-magnifier>
                  </div>
                </div>

              </div>

              </mat-expansion-panel>
            </mat-accordion>

            <!-- ‚≠ê Barre d‚Äôimages -->
            <mat-accordion class="accordion-spacing" *ngIf="document.face || document.liveFace || document.rfidFace">
              <mat-expansion-panel hideToggle expanded (opened)="isFaceOpen = true" (closed)="isFaceOpen  = false">

                <mat-expansion-panel-header [class.header-open]="isFaceOpen " [class.header-closed]="!isFaceOpen ">
                  <mat-panel-title class="panel-title-custom">
                    Face Images
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <div class="image-strip mt-3 d-flex justify-content-center">
                  <div class="img-box" *ngIf="document.face">
                    <h4>Portrait</h4>
                    <div class="face-img">
                      <app-magnifier
                        [src]="'data:image/jpeg;base64,' + document.face"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                  <div class="img-box" *ngIf="document.liveFace">
                    <h4>Photo live</h4>
                    <div class="face-img">
                      <app-magnifier
                        [src]="'data:image/jpeg;base64,' + document.liveFace"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                  <div class="img-box" *ngIf="document.rfidFace">
                    <h4>RFID</h4>
                    <div class="face-img">
                      <app-magnifier
                        [src]="'data:image/jpeg;base64,' + document.rfidFace"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                </div>
              </mat-expansion-panel>
            </mat-accordion>

            <!-- ‚≠ê Infos personnelles -->
            <mat-accordion class="accordion-spacing">
             <mat-expansion-panel hideToggle expanded (opened)="isPersonalInfoOpen  = true" (closed)="isPersonalInfoOpen  = false">
                <mat-expansion-panel-header [class.header-open]="isPersonalInfoOpen " [class.header-closed]="!isPersonalInfoOpen ">
                  <mat-panel-title class="panel-title-custom">
                    Informations Personnelles
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <table class="table table-bordered mt-3">
                  <tbody>
                    <tr>
                      <th>Pr√©nom</th><td>{{ document.firstName }}</td>
                      <th>Nom</th><td>{{ document.lastName }}</td>
                    </tr>
                    <tr>
                      <th>Date de naissance</th><td>{{ document.dateOfBirth | date }}</td>
                      <th>Genre</th><td>{{ document.gender }}</td>
                    </tr>
                    <tr>
                      <th>Num√©ro du document</th><td>{{ document.numDocument }}</td>
                      <th>Date d'expiration</th><td>{{ document.dateOfExp | date }}</td>
                    </tr>
                    <tr>
                      <th>Pays √©metteur</th><td>{{ document.issuingCountry }}</td>
                      <th>Nationalit√©</th><td>{{ document.nationality }}</td>
                    </tr>
                  </tbody>
                </table>
              </mat-expansion-panel>
            </mat-accordion>

            <!-- ‚≠ê Infos RFID -->
            <mat-accordion class="accordion-spacing">
              <mat-expansion-panel hideToggle expanded (opened)="isRfidOpen  = true" (closed)="isRfidOpen  = false">
                <mat-expansion-panel-header [class.header-open]="isRfidOpen" [class.header-closed]="!isRfidOpen ">
                  <mat-panel-title class="panel-title-custom">
                    Informations RFID
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <table class="table table-bordered mt-3">
                  <tbody>
                    <tr>
                      <th>RFID Pr√©nom</th><td>{{ document.rfidFirstName }}</td>
                      <th>RFID Nom</th><td>{{ document.rfidLastName }}</td>
                    </tr>
                    <tr>
                      <th>RFID Date de naissance</th><td>{{ document.rfidDateOfBirth | date }}</td>
                      <th>RFID Genre</th><td>{{ document.rfidGender }}</td>
                    </tr>
                    <tr>
                      <th>RFID Num√©ro du document</th><td>{{ document.rfidNumDocument }}</td>
                      <th>RFID Date d'expiration</th><td>{{ document.rfidDateOfExp | date }}</td>
                    </tr>
                    <tr>
                      <th>RFID Pays √©metteur</th><td>{{ document.rfidIssuingCountry }}</td>
                      <th>RFID Nationalit√©</th><td>{{ document.rfidNationality }}</td>
                    </tr>
                  </tbody>
                </table>
              </mat-expansion-panel>
            </mat-accordion>

          </div> <!-- END CARD BODY -->

        </div> <!-- END CARD -->
      </div>
    </div>
  </div>
</div>
