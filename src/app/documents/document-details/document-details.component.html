<div class="main-content">
  <div class="container-fluid">
    <div *ngIf="isLoading" class="overlay-spinner">
        <mat-spinner diameter="70" strokeWidth="6" color="primary"></mat-spinner>
    </div>
    <div class="row">
      <div class="col-md-12 ml-auto mr-auto">

        <div class="card">
          <div class="card-header card-header-info">
            <h4 class="card-title">Détails du document</h4>
          </div>

          <div class="card-body" *ngIf="document && !isLoading">
            <button mat-raised-button style="color: black;" class="mb-3" (click)="goBack()">
              <mat-icon>arrow_back</mat-icon>
              Retour
            </button>
            <!-- ⭐ Passeport -->
            <mat-accordion class="accordion-spacing" *ngIf="document.typeDoc === 'P' || document.typeDoc === 'PS' || document.typeDoc === 'PD'">
              <mat-expansion-panel hideToggle expanded>
                <mat-expansion-panel-header>
                  <mat-panel-title class="panel-title-custom">
                    Images du passeport
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <!-- Ligne horizontale des infos -->
                <div class="table-responsive">
                  <table class="table table-bordered">

                    <!-- Ligne 1 : Infos texte -->
                    <tr>
                      <td><strong>Ajouté le :</strong> {{ document.dateAjout }} {{ document.heureAjout }}</td>
                      <td><strong>Ajouté par :</strong> {{ document.username }}</td>
                      <td><strong>Code Pays :</strong> {{ document.issuingCountry }}</td>
                      <td>
                        <strong>Type du passeport :</strong>
                        <span [ngSwitch]="document.typeDoc">
                          <span *ngSwitchCase="'P'">Passeport ordinaire</span>
                          <span *ngSwitchCase="'PS'">Passeport de service</span>
                          <span *ngSwitchCase="'PD'">Passeport diplomatique</span>
                          <span *ngSwitchDefault>Inconnu</span>
                        </span>
                      </td>
                    </tr>

                    <!-- Ligne 2 : Images -->
                    <tr>
                      <td colspan="4">
                        <div class="row text-center">

                          <div class="col-md-4 col-12" *ngIf="passportImages.passportImageUrl">
                            <h4>Photo du document</h4>
                            <div class="passport-img-box">
                              <app-magnifier
                                [src]="'data:image/jpeg;base64,' + document.visiblePasseport"
                                [zoom]="2.5"
                                [lensSize]="180">
                              </app-magnifier>
                            </div>
                          </div>

                          <div class="col-md-4 col-12" *ngIf="passportImages.passportImageUrl">
                            <h4>Spécimen du passeport</h4>
                            <div class="passport-img-box">
                              <app-magnifier
                                [src]="passportImages.passportImageUrl"
                                [zoom]="2.5"
                                [lensSize]="180">
                              </app-magnifier>
                            </div>
                          </div>

                          <div class="col-md-4 col-12" *ngIf="passportImages.uvImageUrl">
                            <h4>Spécimen d'image UV</h4>
                            <div class="passport-img-box">
                              <app-magnifier
                                [src]="passportImages.uvImageUrl"
                                [zoom]="2.5"
                                [lensSize]="180">
                              </app-magnifier>
                            </div>
                          </div>

                        </div>
                      </td>
                    </tr>

                  </table>
                </div>
              </mat-expansion-panel>
            </mat-accordion>

            <!-- ⭐ ID Card Images -->
            <mat-accordion class="accordion-spacing" *ngIf="document.frontImage && document.backImage">
              <mat-expansion-panel hideToggle expanded>
                <mat-expansion-panel-header>
                  <mat-panel-title class="panel-title-custom">
                    ID Card Images
                  </mat-panel-title>
                </mat-expansion-panel-header>
                 <div class="table-responsive">
                  <table class="table table-bordered">

                    <!-- Ligne 1 : Infos texte -->
                    <tr>
                      <td><strong>Ajouté le :</strong> {{ document.dateAjout }} {{ document.heureAjout }}</td>
                      <td><strong>Ajouté par :</strong> {{ document.username }}</td>
                    </tr>

                    <!-- Ligne 2 : Images -->
                    <tr>
                      <!-- Face avant -->
                      <td *ngIf="document.frontImage">
                        <h4 class="text-center">Face avant</h4>
                        <div class="passport-img-box text-center">
                          <app-magnifier
                            [src]="'data:image/jpeg;base64,' + document.frontImage"
                            [zoom]="2.5"
                            [lensSize]="180">
                          </app-magnifier>
                        </div>
                      </td>

                      <!-- Face arrière -->
                      <td *ngIf="document.backImage">
                        <h4 class="text-center">Face arrière</h4>
                        <div class="passport-img-box text-center">
                          <app-magnifier
                            [src]="'data:image/jpeg;base64,' + document.backImage"
                            [zoom]="2.5"
                            [lensSize]="180">
                          </app-magnifier>
                        </div>
                      </td>
                    </tr>

                  </table>
                </div>                      
              </mat-expansion-panel>
            </mat-accordion>

            <!-- ⭐ Barre d’images -->
            <mat-accordion class="accordion-spacing" *ngIf="document.face || document.liveFace || document.rfidFace">
              <mat-expansion-panel hideToggle expanded>
                <mat-expansion-panel-header>
                  <mat-panel-title class="panel-title-custom">
                    Face Images
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <div class="image-strip mt-3 d-flex justify-content-center">
                  <div class="img-box" *ngIf="document.face">
                    <h4>Portrait</h4>
                    <div class="fixed-img">
                      <app-magnifier
                        [src]="'data:image/jpeg;base64,' + document.face"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                  <div class="img-box" *ngIf="document.liveFace">
                    <h4>Photo live</h4>
                    <div class="fixed-img">
                      <app-magnifier
                        [src]="'data:image/jpeg;base64,' + document.liveFace"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>

                  <div class="img-box" *ngIf="document.rfidFace">
                    <h4>RFID</h4>
                    <div class="fixed-img">
                      <app-magnifier
                        [src]="'data:image/jpeg;base64,' + document.rfidFace"
                        [zoom]="2.5"
                        [lensSize]="180">
                      </app-magnifier>
                    </div>
                  </div>
                </div>
              </mat-expansion-panel>
            </mat-accordion>

            <!-- ⭐ Infos personnelles -->
            <mat-accordion class="accordion-spacing">
              <mat-expansion-panel hideToggle expanded>
                <mat-expansion-panel-header>
                  <mat-panel-title class="panel-title-custom">
                    Informations Personnelles
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <table class="table table-bordered mt-3">
                  <tbody>
                    <tr>
                      <th>Prénom</th><td>{{ document.firstName }}</td>
                      <th>Nom</th><td>{{ document.lastName }}</td>
                    </tr>
                    <tr>
                      <th>Date de naissance</th><td>{{ document.dateOfBirth | date }}</td>
                      <th>Genre</th><td>{{ document.gender }}</td>
                    </tr>
                    <tr>
                      <th>Numéro du document</th><td>{{ document.numDocument }}</td>
                      <th>Date d'expiration</th><td>{{ document.dateOfExp | date }}</td>
                    </tr>
                    <tr>
                      <th>Pays émetteur</th><td>{{ document.issuingCountry }}</td>
                      <th>Nationalité</th><td>{{ document.nationality }}</td>
                    </tr>
                  </tbody>
                </table>
              </mat-expansion-panel>
            </mat-accordion>

            <!-- ⭐ Infos RFID -->
            <mat-accordion class="accordion-spacing">
              <mat-expansion-panel hideToggle expanded>
                <mat-expansion-panel-header>
                  <mat-panel-title class="panel-title-custom">
                    Informations RFID
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <table class="table table-bordered mt-3">
                  <tbody>
                    <tr>
                      <th>RFID Prénom</th><td>{{ document.rfidFirstName }}</td>
                      <th>RFID Nom</th><td>{{ document.rfidLastName }}</td>
                    </tr>
                    <tr>
                      <th>RFID Date de naissance</th><td>{{ document.rfidDateOfBirth | date }}</td>
                      <th>RFID Genre</th><td>{{ document.rfidGender }}</td>
                    </tr>
                    <tr>
                      <th>RFID Numéro du document</th><td>{{ document.rfidNumDocument }}</td>
                      <th>RFID Date d'expiration</th><td>{{ document.rfidDateOfExp | date }}</td>
                    </tr>
                    <tr>
                      <th>RFID Pays émetteur</th><td>{{ document.rfidIssuingCountry }}</td>
                      <th>RFID Nationalité</th><td>{{ document.rfidNationality }}</td>
                    </tr>
                  </tbody>
                </table>
              </mat-expansion-panel>
            </mat-accordion>

          </div> <!-- END CARD BODY -->

        </div> <!-- END CARD -->
      </div>
    </div>
  </div>
</div>
